<h1>Preview New Data</h1>

{% if update_preview %}
    {% url update_preview as update_preview_url %}
{% else %}
    {% url 'upload' as update_preview_url %}
{% endif %}

<form action="{{ update_preview_url }}" method="POST" enctype="multipart/form-data"  style="margin-top:55px;">
    {% csrf_token %}
    <table class="hide">
        {{ form.as_table }}
    </table>
    <label for="skew">Skew:</label>
    

    <select class="skew_select" name="skew">
        <option value="NONE" {% if skew == 'NONE' %}selected{% endif %} title="original data with no transformation/skew." >Normal</option>
        <option value="LOG" {% if skew == 'LOG' %}selected{% endif %}  title="alogarithm answers the ManagementQuestion: 'How many of one number do we multiply to get another number?.' The number we multiply is called the base. The base 10 logarithm (common) simply gives the answer of how many times we need to multiply 10 to get the number. When plotted this gives us a straight line.">Log Base 10</option>
        <option value="EX10"  {% if skew == 'EX10' %}selected{% endif %} title="" >Exponent Base 10</option>
        <option value="POW2" {% if skew == 'POW2' %}selected{% endif %} title="This is a power transformation where a relative change in one quantity results in a relative change in another and is used when a small number of items are clustered at the top or bottom of the distribution.this is a power transformation where a relative change in one quantity results in a relative change in another and is used when a small number of items are clustered at the top or bottom of the distribution." >Power 2</option>
    </select>

    <a tabindex="0" type="button" class="skew_select_popover" title="Skew definition" data-container="body" data-toggle="popover" data-trigger="focus" data-placement="right" data-content="">
        <i class="fal question-mark fa-question-circle"></i>
    </a>

    <label for="data_order" class="order_select ml-3">Data Order:</label>
    <select class="data_order_select" name="data_order">
        <option value="ASC" {% if data_order == 'ASC' %}selected{% endif %}  heading='Ascending' title="">Ascending</option>
        <option value="DESC" {% if data_order == 'DESC' %}selected{% endif %}  heading='Descending' title="">Descending</option>
    </select>
    <a tabindex="0"  type="button" class="data_order_popover" title="title" data-container="body" data-toggle="popover" data-trigger="focus" data-placement="right" data-content="">
        <i class="fal question-mark fa-question-circle"></i>
    </a>
    {% if risk_data_sets %}
        <input type="hidden" id="risk_data_sets" name="risk_data_sets" value="{{ risk_data_sets }}">
    {% endif %}
    <input type="hidden" id="version_id" name="version_id" value="{{ version_id }}">
    <input type="hidden" id="filename" name="filename" value="{{ filename }}">
    <input type="hidden" id="origional_data_order" name="origional_data_order" value="{{ origional_data_order }}">
    <button  name="update-graph" class="btn btn-primary ml-3 mb-2" type="submit">Update</button>
</form>

<div id='preview-chart'></div>

<div id="initial-preview-chart" class="hide">
    {{ graph|safe }}
</div>

{% if url %}
    {% url url as the_url %}
{% else %}
    {% url 'confirm_upload' version_id as the_url %}
{% endif %}

<form action="{{ the_url }}" method="post">
    {% csrf_token %}
    <table class="hide">
        {{ form.as_table }}
    </table>
    {% if risk_data_sets %}
        <input type="hidden" id="risk_data_sets" name="risk_data_sets" value="{{ risk_data_sets }}">
    {% endif %}
    <input type="hidden" id="version_id" name="version_id" value="{{ version_id }}">
    <input type="hidden" id="origional_data_order" name="origional_data_order" value="{{ origional_data_order }}">
    <input type="submit" class="btn btn-primary mt-3" value="Publish" name="Publish" />
</form>

<table id="records" class="table table-striped table-bordered"  style="width:100%">
    <thead>
        <tr>
            {% for header in headers %}
                <th>{{ header }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% if error_list %}
            {% for record in error_list %}
                <tr>
                    <td style="color:#FF0000">
                        {{ record.country }}
                    </td>
                    <td  style="color:#FF0000">{{ record.score }}</td>
                    <td> <i class="far fa-exclamation-circle" style="color:#FF0000"></i></td>
                </tr>
            {% endfor %}
        {% endif %}
        {% for record in records %}
            <tr>
                {% for item in record %}
                    <td>
                        {% if item or item == 0.0 %}
                            {{ item }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>

{% block js %}
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        $(document).ready(function() {
            $('.data_order_popover').attr('title', $('.data_order_select').children("option:selected").attr('heading'));

            $('.data_order_select').change(function() {
                $('.data_order_popover').attr('data-original-title', $(this).children("option:selected").attr('heading'));
            });
        });
    </script>
{% endblock js %}

